<main>
    <section>
        <header>
            <app-page-description title="Membros" subtitle="Cadastrados" />
            <div class="row-flex space-between center-vertical" *ngIf="!listMembers.emptyData">
               
                <order-list [ordinations]="order.ordinations" (changeOrdination)="changeOrdination($event)" />
    
                <ui-input-search (keywordChange)="onSearch($event)" />

                <button 
                    class="btn btn-lg"
                    color="purple"
                    radius="true"
                    (click)="router.navigateByUrl('/app/create/member')"
                    matRipple
                >CADASTRAR NOVO</button>
            </div>
        </header>
       
        <app-no-data-created message="Você ainda não têm membros cadastrados" [isVisible]="listMembers.emptyData">
            <button 
                class="btn btn-lg"
                color="purple"
                radius="true"
                (click)="router.navigateByUrl('/app/create/member')"
                matRipple
            >CADASTRAR NOVO</button>
        </app-no-data-created>
        
        <ng-template #loading>
            <ui-table-skeleton />
        </ng-template>

        <ui-command-bar
            *ngIf="pagination.total != 0"
            [countSelecteds]="countSelecteds"
            (deleteCommnad)="deleteSelecteds()"
            (generateCredentialsCommnad)="generateCredentials()"
            [showDeleteCommand]="true"
            [showEmitCredentialCommand]="true"
        />

        <div class="content" *ngIf="members$ | async as members; else loading">
            <table class="ui-table default">
                <tr>
                    <th>
                        <mat-checkbox
                            [disabled]="pagination.total == 0"
                            [checked]="allSelecteds()"
                            [indeterminate]="someSelecteds()"
                            (change)="onToggleSelection.run($event.checked)"
                        ></mat-checkbox>
                    </th>
                    <th>Foto</th>
                    <th>Membro</th>
                    <th>Estado civil</th>
                    <th>Idade</th>
                    <th>Registrado</th>
                    <th>Ações</th>
                </tr>
                <tr *ngFor="let member of members">
                    <td>
                        <mat-checkbox 
                            [checked]="member.isSelected"
                            (change)="onSelect.run($event.checked, member)"
                        ></mat-checkbox>
                    </td>
                    <td class="photo-column">
                        <img class="photo-member" [src]="member.photo.url" [alt]="member.name" (click)="onFullScreen.run(member.photo)">
                    </td>
                    <td>{{ member.name }}</td>
                    <td>{{ member.maritalStatus | maritalstatus }}</td>
                    <td>{{ member.age }} anos</td>
                    <td>{{ member.createdAt | dateDuration }}</td>
                    <td>
                        <button mat-icon-button (click)="onPrint.run(member.id)">
                            <mat-icon class="material-icons-outlined">badge</mat-icon>
                        </button>
                        <button mat-icon-button (click)="goToEdit.run(member.id)">
                            <mat-icon>edit_note</mat-icon>
                        </button>
                        <button mat-icon-button (click)="onDelete.run(member.id, member)">
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </td>
                </tr>
            </table>
            <app-pagination (changePage)="changePage($event.value)" [pageable]="listMembers.pageable" />
        </div>
        <such-notfound [keyword]="searchValue" [isVisible]="listMembers.searchNotFound" />
    </section>
</main>

<ngx-spinner 
    bdColor="rgba(0, 0, 0, 0.8)"
    size="medium"
    color="#8e27fa"
    type="ball-atom"
    [fullScreen]="true">
</ngx-spinner>